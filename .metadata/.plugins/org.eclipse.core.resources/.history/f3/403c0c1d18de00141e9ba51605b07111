package com.panerabread.auit.pages.concrete;

import org.openqa.selenium.WebElement;

import com.panerabread.auit.pages.BasePage;
import com.panerabread.auit.pages.OrderTimePage;
import com.panerabread.auit.pages.OrderTypeLocationPage;
import com.panerabread.auit.webdriverutils.AdvancedWebDriver;

public class DefaultOrderTypeLocationPage extends BasePage implements
		OrderTypeLocationPage {
	
	private final String SEARCH_BOX = "#cafeSearch", 
			DEL_ADDRESS_FIELD = ".form-control",
			CHECK_AVAILABILITY = "input.btn",
			//ORDER_BTN = ".artisan-scroll > div:nth-child(1) > cafe:nth-child(1) > div:nth-child(1) > div:nth-child(1) > div:nth-child(3) > div:nth-child(2) > a:nth-child(1)",
			CAFE_SCRIPT_FORMAT = "return (function b(){ return (function a(cafeId){var foundCafe = null; Array.prototype.slice.call(document.querySelectorAll(\'.cafeName\')).forEach(function(cafe) {if(cafe.innerHTML.indexOf(cafeId) > 0) {foundCafe = cafe;}}); return foundCafe;}) ('%s').parentElement.nextSibling.nextSibling.getElementsByTagName('a')[0]})();",
			MY_ACCOUNT="li.dropdown:nth-child(4) > a:nth-child(1)",
			OLD_PASSWORD="#info\.currentPassword",
			NEW_PASSWORD="#info\.newPassword",
			CONFIRM_PASSWORD="#info\.confirmPassword",
			UPDATE_PASSWORD="#changePassword > div:nth-child(8) > div:nth-child(1) > button:nth-child(1)",
			FIRST_NAME="#info\.firstName",
			LAST_NAME="#info\.lastName",
			ADDRESS="#address\.address1",
			CITY="#address\.city",
			STATE="#address\.state",
			ZIP="#address\.zip",
			PHONE_NUMBER="#info\.phone",
			EMAIL="#info\.email",
			UPDATE_ACCOUNT_INFO="div.form-group:nth-child(16) > div:nth-child(1) > button:nth-child(1)";
	
	public DefaultOrderTypeLocationPage(AdvancedWebDriver driver) {
		super(driver);
	}

	public OrderTimePage chooseCafe(String search, int cafeId) {
		searchForCafe(search);
		return chooseCafe(cafeId);
	}

	public OrderTypeLocationPage searchForCafe(String search) {
		WebElement searchBox = driver().findByCSS(this.SEARCH_BOX);
		searchBox.sendKeys(search);
		driver().pause(5000);
		return this;
	}

	public OrderTimePage chooseCafe(int cafeId) {
		driver().clickByJavascript(String.format(this.CAFE_SCRIPT_FORMAT, cafeId));
		return PageFactory.getOrderTimePage(driver());
	}
	
	public OrderTimePage enterDeliveryAddress(String address){
		driver().pause(1000);
		driver().findByCSS(this.DEL_ADDRESS_FIELD).sendKeys(address);
		driver().clickByCSS(this.CHECK_AVAILABILITY);
		return PageFactory.getOrderTimePage(driver());
	}
	
}